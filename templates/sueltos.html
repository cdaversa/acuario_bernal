{% extends "layout.html" %}
{% block title %}Productos Sueltos{% endblock %}
{% block content %}
<h2>🐾 Productos Sueltos</h2>

<!-- 🔗 Botón para ir a la pantalla de configuración -->
<a href="{{ url_for('configurar_sueltos') }}" class="btn btn-warning mb-3">⚙️ Configuración (Importar / Exportar / Agregar)</a>

<!-- ✅ Campo de búsqueda -->
<h4 class="mt-4">🔍 Buscar Productos Sueltos</h4>
<input type="text" id="buscador_sueltos" class="form-control mb-3" placeholder="🔍 Buscar producto suelto...">

<!-- ✅ Botones de filtro por categoría -->
<div class="btn-group mb-3">
  <button class="btn btn-outline-secondary btn-filter active" data-filter="all">Todos</button>
  <button class="btn btn-outline-secondary btn-filter" data-filter="perro">Perros</button>
  <button class="btn btn-outline-secondary btn-filter" data-filter="gato">Gatos</button>
  <button class="btn btn-outline-secondary btn-filter" data-filter="piedras">Piedras</button>
</div>

<!-- ✅ Contenedor de tablas (sin cambios en tu estructura original) -->
<div id="tabla-sueltos">
  {% for categoria, lista in {'Perro':perros, 'Gato':gatos, 'Piedras':piedras}.items() %}
  <div class="categoria-block" data-categoria="{{ categoria|lower }}">
    <h3 class="mt-2">{{ categoria }}</h3>
    <table class="table table-bordered">
      <thead><tr><th>Producto</th><th>Precio</th><th>Acciones</th></tr></thead>
      <tbody>
      {% for p in lista %}
        <tr>
          <td>{{ p['nombre'] }}</td>
          <td>{{ p['precio']|precio }}</td>
          <td>
            <a href="{{ url_for('editar_suelto', id=p['id']) }}" class="btn btn-primary btn-sm">✏️ Editar</a>
            <a href="{{ url_for('eliminar_suelto_ruta', id=p['id']) }}" class="btn btn-danger btn-sm" onclick="return confirm('¿Eliminar?')">🗑</a>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  {% endfor %}
</div>

<script>
// ✅ (Se mantiene tu buscador y filtro sin cambios)
document.getElementById("buscador_sueltos").addEventListener("keyup", function () {
    let filtro = this.value.toLowerCase();
    document.querySelectorAll("#tabla-sueltos .categoria-block").forEach(bloque => {
        let filas = bloque.querySelectorAll("tbody tr");
        let hayCoincidencia = false;
        filas.forEach(row => {
            let visible = row.innerText.toLowerCase().includes(filtro) || filtro === "";
            row.style.display = visible ? "" : "none";
            if (visible) hayCoincidencia = true;
        });
        bloque.style.display = hayCoincidencia ? "" : "none";
    });
});

document.querySelectorAll(".btn-filter").forEach(btn => {
    btn.addEventListener("click", () => {
        document.querySelectorAll(".btn-filter").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const filtro = btn.dataset.filter;
        document.querySelectorAll(".categoria-block").forEach(block => {
            block.style.display = (filtro === "all" || block.dataset.categoria === filtro) ? "" : "none";
        });
    });
});
</script>
{% endblock %}
